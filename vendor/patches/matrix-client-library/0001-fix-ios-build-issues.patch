From eb03e88e6d0cb9511d796d88f4d25e8ee46e65d5 Mon Sep 17 00:00:00 2001
From: Reza Alizadeh Majd <r.majd@pantherx.org>
Date: Tue, 22 Nov 2022 00:19:21 +0330
Subject: [PATCH] fix ios build issues

Signed-off-by: Reza Alizadeh Majd <r.majd@pantherx.org>
---
 CMakeLists.txt                  | 6 +++++-
 src/voip/AudioDeviceControl.cpp | 2 +-
 src/voip/AudioDeviceControl.h   | 2 +-
 src/voip/AudioDevices.cpp       | 2 +-
 src/voip/AudioDevices.h         | 2 +-
 src/voip/AudioInfo.cpp          | 4 ++--
 src/voip/AudioInfo.h            | 2 +-
 7 files changed, 12 insertions(+), 8 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 9fea324..d090998 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -229,6 +229,10 @@ if (CMAKE_SYSTEM_NAME STREQUAL "Android")
 	if(CIBA_AUTHENTICATION)
 		list(APPEND DEP_LIBS px-auth-lib-cpp_${CMAKE_ANDROID_ARCH_ABI})
 	endif()
+elseif(IOS)
+	if(CIBA_AUTHENTICATION)
+		list(APPEND DEP_LIBS px-auth-lib-cpp)
+	endif()
 else()
 	pkg_check_modules(
 		PULSE REQUIRED
@@ -244,7 +248,7 @@ else()
 						${GLIB_LDFLAGS})
 endif()
 
-if (NOT CMAKE_SYSTEM_NAME STREQUAL "Android")
+if (NOT CMAKE_SYSTEM_NAME STREQUAL "Android" AND NOT IOS)
 	pkg_check_modules(coeurl REQUIRED IMPORTED_TARGET coeurl)
 endif()
 
diff --git a/src/voip/AudioDeviceControl.cpp b/src/voip/AudioDeviceControl.cpp
index e5246c8..fa2e6f4 100644
--- a/src/voip/AudioDeviceControl.cpp
+++ b/src/voip/AudioDeviceControl.cpp
@@ -1,5 +1,5 @@
 #include "AudioDeviceControl.h"
-#ifndef Q_OS_ANDROID
+#if !defined(Q_OS_ANDROID) && !defined(Q_OS_IOS)
 #include <stdlib.h>
 #include <math.h>
 #include <QDateTime>
diff --git a/src/voip/AudioDeviceControl.h b/src/voip/AudioDeviceControl.h
index 5d8c47e..bfe3038 100644
--- a/src/voip/AudioDeviceControl.h
+++ b/src/voip/AudioDeviceControl.h
@@ -5,7 +5,7 @@
 #include <QScopedPointer>
 #include <QtGlobal>
 
-#ifndef Q_OS_ANDROID
+#if !defined(Q_OS_ANDROID) && !defined(Q_OS_IOS)
 #include <QAudioInput>
 #else
 
diff --git a/src/voip/AudioDevices.cpp b/src/voip/AudioDevices.cpp
index 5fbb5f6..06eb7a4 100644
--- a/src/voip/AudioDevices.cpp
+++ b/src/voip/AudioDevices.cpp
@@ -2,7 +2,7 @@
 
 #include <QtGlobal>
 
-#ifndef Q_OS_ANDROID
+#if !defined(Q_OS_ANDROID) && !defined(Q_OS_IOS)
 #include <QDebug>
 #include <glib.h>
 #include "Logging.h"
diff --git a/src/voip/AudioDevices.h b/src/voip/AudioDevices.h
index 175e6c0..458191b 100644
--- a/src/voip/AudioDevices.h
+++ b/src/voip/AudioDevices.h
@@ -4,7 +4,7 @@
 #include <QObject>
 #include <QtGlobal>
 
-#ifndef Q_OS_ANDROID
+#if !defined(Q_OS_ANDROID) && !defined(Q_OS_IOS)
 #include <pulse/pulseaudio.h>
 #include <pulse/glib-mainloop.h>
 #include <pulse/ext-stream-restore.h>
diff --git a/src/voip/AudioInfo.cpp b/src/voip/AudioInfo.cpp
index 352a177..8e2d777 100644
--- a/src/voip/AudioInfo.cpp
+++ b/src/voip/AudioInfo.cpp
@@ -5,11 +5,11 @@
 #include <QDebug>
 #include <qendian.h>
 
-#ifndef Q_OS_ANDROID
+#if !defined(Q_OS_ANDROID) && !defined(Q_OS_IOS)
 #include <QAudioInput>
 #endif
 
-#ifndef Q_OS_ANDROID
+#if !defined(Q_OS_ANDROID) && !defined(Q_OS_IOS)
 
 AudioInfo::AudioInfo(const QAudioFormat &format)
     : m_format(format)
diff --git a/src/voip/AudioInfo.h b/src/voip/AudioInfo.h
index 381488d..70fcef7 100644
--- a/src/voip/AudioInfo.h
+++ b/src/voip/AudioInfo.h
@@ -5,7 +5,7 @@
 #include <QObject>
 #include <QtGlobal>
 
-#ifndef Q_OS_ANDROID
+#if !defined(Q_OS_ANDROID) && !defined(Q_OS_IOS)
 #include <QAudioInput>
 #else
 struct QAudioFormat {};
-- 
2.38.1

